(function(e){var l=[];var t={init:function(t){return this.each(function(){var a=this;var i=e(a).data("cbgallery");if(i){return}i={};i.options=t;i.defaults=e.fn.cbgallery.defaults;i.settings=e.extend(true,{},i.defaults,i.options);i.element=e(a);if(i.settings.useData){e.each(i.defaults,function(e,l){if(e!="init"&&e!="useData"){var t=i.element.data("cbgallery"+e.charAt(0).toUpperCase()+e.slice(1));if(typeof t!="undefined"){i.settings[e]=t}else{t=i.element.data("cbgallery"+e.charAt(0).toUpperCase()+e.slice(1).toLowerCase());if(typeof t!="undefined"){i.settings[e]=t}}}})}i.element.trigger("cbgallery.init.before",[i]);if(!i.settings.init){return}if(i.settings.request===null||typeof i.settings.request!="object"&&!e.isArray(i.settings.request)){i.settings.request={}}e.ajaxPrefilter(function(e,l,t){e.async=true});if(i.settings.mode=="modal"){if(!i.settings.url){return}if(i.settings.previous){i.settings.request["previous"]=i.settings.previous}if(i.settings.next){i.settings.request["next"]=i.settings.next}i.navigationHandler=function(l){var t=i.element.data("cbtooltip");if(!t||e(l.target).is("input,textarea")){return}switch(l.which){case 27:var a=t.tooltip.qtip("api").elements.content.find(".galleryModalClose");if(a.length){a.click()}else{return}break;case 37:var n=t.tooltip.qtip("api").elements.content.find(".galleryModalScrollLeftIcon");if(n.length){n.click()}else{return}break;case 39:var r=t.tooltip.qtip("api").elements.content.find(".galleryModalScrollRightIcon");if(r.length){r.click()}else{return}break;default:return}l.preventDefault()};i.actionHandler=function(l){var t=i.element.data("cbtooltip");if(!t){return}l.preventDefault();var a=e(l.target).attr("href");var n=null;t.tooltip.qtip("api").set("content.text",function(l,r){if(n==null){n=e.ajax({url:a,type:"GET",dataType:"html",cache:false,beforeSend:function(e,l,a){i.element.triggerHandler("cbgallery.modal.action.send",[i,t,e,l,a])}}).fail(function(e,l,a){i.element.triggerHandler("cbgallery.modal.action.error",[i,t,e,l,a])}).done(function(a,n,s){if(!r.destroyed){e(document).off("keydown",i.navigationHandler);e(document).off("click",".galleryModalAction",i.actionHandler);var d=null;try{d=JSON.parse(a)}catch(e){d={status:true,message:a}}var o=i.displayHandler(l,t);o.done(function(e,l,a){if(d&&typeof d.status!=="undefined"){if(d.status===true){if(typeof d.message!=="undefined"&&d.message){if(r.elements.content){r.elements.content.find(".galleryModalDisplay").prepend('<div class="galleryModalAlert alert alert-sm alert-success">'+d.message+"</div>")}}i.element.trigger("cbgallery.modal.action.success",[i,t,d,l,a])}else if(d.status===false){if(typeof d.message!=="undefined"&&d.message){if(r.elements.content){r.elements.content.find(".galleryModalDisplay").prepend('<div class="galleryModalAlert alert alert-sm alert-danger">'+d.message+"</div>")}}i.element.trigger("cbgallery.modal.action.failed",[i,t,d,l,a])}}})}i.element.triggerHandler("cbgallery.modal.action.always",[i,t,a,n,s])})}return'<div class="galleryModalLoading text-center"><span class="fa fa-spinner fa-pulse fa-3x"></span></div>'});i.element.trigger("cbgallery.modal.action",[i,t,n,l]);return n};i.closeHandler=function(){e(document).off("keydown",i.navigationHandler);e(document).off("click",".galleryModalAction",i.actionHandler);e("body").removeClass("galleryModalOpen");e("body > .galleryHeadersScripts").remove()};i.element.on("cbtooltip.hidden",i.closeHandler);i.moveHandler=function(e,l,t,a){if(a.elements.tooltip){a.elements.content.find(".galleryModalItem,.galleryModalLoading").css("line-height",a.elements.content.css("max-height"));a.elements.content.find(".galleryRotate90,.galleryRotate270").css("max-width",a.elements.content.css("max-height"))}};i.element.on("cbtooltip.move",i.moveHandler);i.displayHandler=function(l,t){var a=null;t.tooltip.qtip("api").set("content.text",function(l,s){if(a==null){a=e.ajax({url:i.settings.url,type:"GET",dataType:"html",cache:false,data:i.settings.request,beforeSend:function(e,l,a){i.element.triggerHandler("cbgallery.modal.send",[i,t,e,l,a])}}).fail(function(e,l,a){if(!s.destroyed){s.hide()}i.element.triggerHandler("cbgallery.modal.error",[i,t,e,l,a])}).done(function(l,a,d){if(!s.destroyed){var o=e(l);var c=n.call(o,i);s.set("content.text",o.html());r.call(s.elements.content,i,c);if(s.elements.content){s.elements.content.find('.cbTooltip,[data-hascbtooltip="true"]').cbtooltip();s.elements.content.find(".galleryModalScrollLeftIcon").on("click",function(){var l=e(this).data("cbgallery-previous");if(l){s.toggle(false);e(l).find(".galleryModalToggle").click()}});s.elements.content.find(".galleryModalScrollRightIcon").on("click",function(){var l=e(this).data("cbgallery-next");if(l){s.toggle(false);e(l).find(".galleryModalToggle").click()}})}e(document).on("keydown",i.navigationHandler);e(document).on("click",".galleryModalAction",i.actionHandler);e("body").addClass("galleryModalOpen")}i.element.triggerHandler("cbgallery.modal.success",[i,t,l,a,d])})}return'<div class="galleryModalLoading text-center"><span class="fa fa-spinner fa-pulse fa-3x"></span></div>'});i.element.trigger("cbgallery.modal",[i,t,a,l]);return a};i.element.on("cbtooltip.render",i.displayHandler)}else if(i.settings.mode=="share"){if(!i.settings.url){return}i.element.find(".galleryShareUpload").fileupload({url:i.settings.url,dataType:"html",sequentialUploads:true,dropZone:i.element.find(".galleryShareUploadDropZone"),pasteZone:e(document),add:function(l,t){if(i.settings.callback.upload.add){i.element.find(".galleryShareUploadProgress").removeClass("hidden")}e.each(t.files,function(e,l){l.error=null;l.context=null;if(i.settings.callback.upload.add){l.context=i.settings.callback.upload.add.call(i.element,i,t,l)}if(l.context){l.context.find(".galleryShareUploadProgressCancel").on("click",function(){t.abort();l.context.find(".progress-bar").css("width","100%").removeClass("progress-bar-striped active").addClass("progress-bar-warning");l.context.find(".galleryShareUploadProgressClear").removeClass("hidden");l.context.find(".galleryShareUploadProgressCancel").remove()});l.context.find(".galleryShareUploadProgressClear").on("click",function(){l.context.next(".galleryShareUploadProgressError").remove();l.context.remove();if(!i.element.find(".galleryShareUploadProgressRow").length){i.element.find(".galleryShareUploadProgress").addClass("hidden")}});l.context.appendTo(".galleryShareUploadProgressRows")}i.element.trigger("cbgallery.upload.add.file",[i,l,t])});t.process().done(function(){t.submit()});i.element.trigger("cbgallery.upload.add",[i,t])},progress:function(e,l){var t=l.files[0].context;if(t){t.find(".progress-bar").css("width",parseInt(l.loaded/l.total*100,10)+"%")}i.element.trigger("cbgallery.upload.progress",[i,t,l])},fail:function(e,l){i.element.trigger("cbgallery.upload.error",[i,file,l])},done:function(l,t){var a=null;try{a=JSON.parse(t.result)}catch(e){a={status:true,message:t.result}}var s=t.files[0].context;if(s){var d=s.find(".progress-bar");s.find(".galleryShareUploadProgressClear").removeClass("hidden");s.find(".galleryShareUploadProgressCancel").remove();d.css("width","100%").removeClass("progress-bar-striped active")}if(a&&typeof a.status!=="undefined"){if(a.status===true){if(s){d.addClass("progress-bar-success")}if(typeof a.message!=="undefined"&&a.message){var o=e(a.message).hide();var c=n.call(o,i);i.element.find(".galleryShareEdit").removeClass("hidden").append(o);r.call(o,i,c);o.find('.cbTooltip,[data-hascbtooltip="true"]').cbtooltip();if(s){s.fadeOut("slow",function(){s.find(".galleryShareUploadProgressClear").click()})}o.fadeIn("slow")}i.element.trigger("cbgallery.upload.success",[i,s,t])}else if(a.status===false){if(s){d.addClass("progress-bar-danger");if(typeof a.message!=="undefined"&&a.message){if(i.settings.callback.upload.error){s.error=i.settings.callback.upload.error.call(i.element,i,a,s,t)}if(s.error){s.after(s.error)}}}i.element.trigger("cbgallery.upload.failed",[i,s,t])}}i.element.trigger("cbgallery.upload.always",[i,s,t])}});i.dropZoneHandler=function(l){if(!e(l.target).is("input")){l.preventDefault();i.element.find(".galleryShareUpload").click()}};i.element.find(".galleryShareUploadDropZone").on("click",i.dropZoneHandler);i.linkSaveHandler=function(l){l.preventDefault();var t=e(this);var a=i.element.find(".galleryShareLink");if(a.val()){i.settings.request["value"]=a.val();e.ajax({url:i.settings.url,type:"POST",dataType:"html",cache:false,data:i.settings.request,beforeSend:function(e,l,n){a.prop("disabled",true);t.prop("disabled",true);i.element.find(".galleryShareLinkLoading").removeClass("hidden");i.element.find(".galleryShareLinkArea").removeClass("has-error");i.element.find(".galleryShareLinkError").remove();i.element.triggerHandler("cbgallery.link.send",[i,e,l,n])}}).fail(function(e,l,t){i.element.find(".galleryShareLinkLoading").addClass("hidden");i.element.find(".galleryShareLinkArea").addClass("has-error");i.element.triggerHandler("cbgallery.link.error",[i,e,l,t])}).done(function(l,s,d){var o=null;try{o=JSON.parse(l)}catch(e){o={status:true,message:l}}i.element.find(".galleryShareLinkLoading").addClass("hidden");a.prop("disabled",false);t.prop("disabled",false);if(o&&typeof o.status!=="undefined"){if(o.status===true){a.val("");if(typeof o.message!=="undefined"&&o.message){var c=e(o.message).hide();var f=n.call(c,i);i.element.find(".galleryShareEdit").removeClass("hidden").append(c);r.call(c,i,f);c.find('.cbTooltip,[data-hascbtooltip="true"]').cbtooltip();c.fadeIn("slow")}i.element.trigger("cbgallery.link.success",[i,o,s,d])}else if(o.status===false){i.element.find(".galleryShareLinkArea").addClass("has-error");if(typeof o.message!=="undefined"&&o.message){var g=null;if(i.settings.callback.link.error){g=i.settings.callback.link.error.call(i.element,i,o,l)}if(g){i.element.find(".galleryShareLinkArea").append(g)}}i.element.trigger("cbgallery.link.failed",[i,o,s,d])}}i.element.triggerHandler("cbgallery.link.always",[i,o,s,d])})}else{i.element.find(".galleryShareLinkArea").addClass("has-error")}};i.element.find(".galleryShareLinkSave").on("click",i.linkSaveHandler)}else if(i.settings.mode=="edit"){i.deleteHandler=function(l){l.preventDefault();var t=e(this).data("cbgallery-delete-url");if(!t){return false}e.cbconfirm(e(this).data("cbgallery-delete-message")).done(function(){e.ajax({url:t,type:"POST",dataType:"html",cache:false,beforeSend:function(e,l,t){i.element.removeClass("panel-danger").addClass("panel-default");i.element.find(".galleryEditError").remove();i.element.find(".galleryEditLoading").removeClass("hidden").css("line-height",i.element.outerHeight()+"px");i.element.triggerHandler("cbgallery.delete.send",[i,e,l,t])}}).fail(function(e,l,t){i.element.find(".galleryEditLoading").addClass("hidden");i.element.removeClass("panel-default").addClass("panel-danger");i.element.triggerHandler("cbgallery.delete.error",[i,e,l,t])}).done(function(l,t,a){var n=null;try{n=JSON.parse(l)}catch(e){n={status:true,message:l}}i.element.find(".galleryEditLoading").addClass("hidden");if(n&&typeof n.status!=="undefined"){if(n.status===true){i.element.fadeOut("slow",function(){e(this).remove()});i.element.trigger("cbgallery.delete.success",[i,n,t,a])}else if(n.status===false){i.element.removeClass("panel-default").addClass("panel-danger");if(typeof n.message!=="undefined"&&n.message){var r=null;if(i.settings.callback.delete.error){r=i.settings.callback.delete.error.call(i.element,i,n,l,t,a)}if(r){i.element.prepend(r)}}i.element.trigger("cbgallery.delete.failed",[i,n,t,a])}}i.element.triggerHandler("cbgallery.delete.always",[i,n,t,a])})});return false};i.element.find(".galleryEditDelete").on("click",i.deleteHandler);i.editHandler=function(l){l.preventDefault();i.element.find(".galleryEditForm").ajaxSubmit({type:"POST",dataType:"html",beforeSerialize:function(e,l){i.element.triggerHandler("cbgallery.save.serialize",[i,e,l])},beforeSubmit:function(e,l,t){var a=i.element.data("cbvalidate");if(a){if(!a.element.cbvalidate("validate")){return false}}i.element.removeClass("panel-danger").addClass("panel-default");i.element.find(".galleryEditError").remove();i.element.find(".galleryEditLoading").removeClass("hidden").css("line-height",i.element.outerHeight()+"px");i.element.triggerHandler("cbgallery.save.submit",[i,e,l,t])},error:function(e,l,t){i.element.find(".galleryEditLoading").addClass("hidden");i.element.removeClass("panel-default").addClass("panel-danger");i.element.triggerHandler("cbgallery.save.error",[i,e,l,t])},success:function(l,t,a){var s=null;try{s=JSON.parse(l)}catch(e){s={status:true,message:l}}i.element.find(".galleryEditLoading").addClass("hidden");if(s&&typeof s.status!=="undefined"){if(s.status===true){var d=e(l).hide();var o=n.call(d,i);i.element.replaceWith(d);r.call(d,i,o);d.find('.cbTooltip,[data-hascbtooltip="true"]').cbtooltip();d.fadeIn("slow");i.element.triggerHandler("cbgallery.save.success",[i,s,l,t,a])}else if(s.status===false){i.element.removeClass("panel-default").addClass("panel-danger");if(typeof s.message!=="undefined"&&s.message){var c=null;if(i.settings.callback.edit.error){c=i.settings.callback.edit.error.call(i.element,i,s,l,t,a)}if(c){i.element.prepend(c)}}i.element.triggerHandler("cbgallery.save.failed",[i,s,l,t,a])}}}});return false};i.element.find(".galleryEditSave").on("click",i.editHandler)}i.element.on("remove destroy.cbgallery",function(){i.element.cbgallery("destroy")});i.element.on("rebind.cbgallery",function(){i.element.cbgallery("rebind")});i.element.on("modified.cbgallery",function(e,l,t,a){if(t!=a){i.element.cbgallery("destroy");i.element.cbgallery(i.options)}});i.element.on("cloned.cbgallery",function(l,t){e(this).off("destroy.cbgallery");e(this).off("rebind.cbgallery");e(this).off("cloned.cbgallery");e(this).off("modified.cbgallery");if(i.settings.mode=="modal"){e(document).off("keydown",i.navigationHandler);e(document).off("click",".galleryModalAction",i.actionHandler);e(this).off("cbtooltip.hidden",i.closeHandler);e(this).off("cbtooltip.move",i.moveHandler);e(this).off("cbtooltip.render",i.displayHandler)}else if(i.settings.mode=="share"){e(this).find(".galleryShareUpload").fileupload("destroy");e(this).find(".galleryShareUploadDropZone").off("click",i.dropZoneHandler);e(this).find(".galleryShareLinkSave").off("click",i.linkSaveHandler)}else if(i.settings.mode=="edit"){e(this).find(".galleryEditDelete").on("click",i.deleteHandler);e(this).find(".galleryEditSave").on("click",i.editHandler)}e(this).removeData("cbgallery");e(this).cbgallery(i.options)});i.element.trigger("cbgallery.init.after",[i]);i.element.data("cbgallery",i);l.push(i)})},rebind:function(){var l=e(this).data("cbgallery");if(!l){return this}l.element.cbgallery("destroy");l.element.cbgallery(l.options);return this},destroy:function(){var t=e(this).data("cbgallery");if(!t){return false}t.element.off("destroy.cbgallery");t.element.off("rebind.cbgallery");t.element.off("cloned.cbgallery");t.element.off("modified.cbgallery");e.each(l,function(e,a){if(a.element==t.element){l.splice(e,1);return false}return true});if(t.settings.mode=="modal"){e(document).off("keydown",t.navigationHandler);e(document).off("click",".galleryModalAction",t.actionHandler);t.element.off("cbtooltip.hidden",t.closeHandler);t.element.off("cbtooltip.move",t.moveHandler);t.element.off("cbtooltip.render",t.displayHandler)}else if(t.settings.mode=="share"){t.element.find(".galleryShareUpload").fileupload("destroy");t.element.find(".galleryShareUploadDropZone").off("click",t.dropZoneHandler);t.element.find(".galleryShareLinkSave").off("click",t.linkSaveHandler)}else if(t.settings.mode=="edit"){t.element.find(".galleryEditDelete").on("click",t.deleteHandler);t.element.find(".galleryEditSave").on("click",t.editHandler)}t.element.removeData("cbgallery");t.element.trigger("cbgallery.destroyed",[t]);return true},instances:function(){return l}};function a(e){if(typeof e!="string"){return e}return e.split("/").pop().replace(/(?:&|\?).+/g,"")}function n(l){var t=this.jquery?this:e(this);var n=t.find(".galleryHeaders");if(!n.length){return[]}var r=e("head");var i=[];var s=[];if(l.settings.mode=="modal"){e("body > .galleryHeadersScripts").remove()}r.find("link").each(function(){var l=e(this).attr("href");if(typeof l!="undefined"){i.push(a(l))}});r.find("script").each(function(){var l=e(this).attr("src");if(typeof l!="undefined"){s.push(a(l))}});n.children("link").each(function(){var l=e(this).attr("href");if(typeof l!="undefined"&&i.indexOf(a(l))!==-1){e(this).remove()}});var d=[];n.children("script").each(function(){var l=e(this).attr("src");if(typeof l=="undefined"){d.push(this)}else{if(s.indexOf(a(l))===-1){d.push(this)}}e(this).remove()});return d}function r(l,t){if(!t.length){return}var a=this.jquery?this:e(this);var n=e('<div class="galleryHeadersScripts" style="position: absolute; display: none; height: 0; width: 0; z-index: -999;" />');var r=function(l){var a=l+1;var i=e(this).attr("src");if(i){e.ajax({url:i,dataType:"script"}).always(function(){n.append('<script type="text/javascript" src="'+i+'"></script>');if(typeof t[a]!="undefined"){r.call(t[a],a)}})}else{n.append('<script type="text/javascript">'+e(this).text()+"</script>");if(typeof t[a]!="undefined"){r.call(t[a],a)}}};r.call(t[0],0);if(l.settings.mode=="modal"){e("body").append(n)}else{a.find(".galleryHeaders").append(n)}}e.fn.cbgallery=function(e){if(t[e]){return t[e].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof e==="object"||!e){return t.init.apply(this,arguments)}return this};e.fn.cbgallery.defaults={init:true,useData:true,mode:"modal",url:null,previous:null,next:null,request:null,callback:{upload:{add:null,error:null},link:{error:null},delete:{error:null},edit:{error:null}}}})(jQuery);