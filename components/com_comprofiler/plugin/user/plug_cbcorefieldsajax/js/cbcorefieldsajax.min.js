!function(e){function t(){var t=this.jquery?this:e(this),i=e("head"),n=[],a=[];i.find("link").each(function(){var t=e(this).attr("href");"undefined"!=typeof t&&n.push(t)}),i.find("script").each(function(){var t=e(this).attr("src");"undefined"!=typeof t&&a.push(t)}),t.find(".cbAjaxHeaders > link").each(function(){var t=e(this).attr("href");"undefined"!=typeof t&&-1!==n.indexOf(t)&&e(this).remove()}),t.find(".cbAjaxHeaders > script").each(function(){var t=e(this).attr("src");"undefined"!=typeof t&&-1!==a.indexOf(t)&&e(this).remove()})}var i=[],n={init:function(n){return this.each(function(){var a=this,d=e(a).data("cbajaxfield");d||(d={},d.options=n,d.defaults=e.fn.cbajaxfield.defaults,d.settings=e.extend(!0,{},d.defaults,d.options),d.element=e(a),d.settings.useData&&e.each(d.defaults,function(e){if("init"!=e&&"useData"!=e){var t=d.element.data("cbajaxfield"+e.charAt(0).toUpperCase()+e.slice(1));"undefined"!=typeof t?d.settings[e]=t:(t=d.element.data("cbajaxfield"+e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()),"undefined"!=typeof t&&(d.settings[e]=t))}}),d.element.trigger("cbajaxfield.init.before",[d]),d.settings.init&&(e.ajaxPrefilter(function(e){e.async=!0}),d.editHandler=function(i){if(!d.settings.ignore||d.settings.ignore&&!e(i.target).is(d.settings.ignore)&&!e(i.target).parents().is(d.settings.ignore)){var n=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;e.ajax({url:d.settings.editUrl,type:"GET",dataType:"html",cache:!1,beforeSend:function(t,i,n){e(document).find(".cbAjaxCancel").click(),d.settings.tooltip||d.element.find(".cbAjaxValue").addClass("hidden"),d.element.append('<span class="cbSpinner fa fa-spinner fa-spin-fast"></span>'),d.element.triggerHandler("cbajaxfield.edit.send",[d,t,i,n])},error:function(e,t,i){d.element.find(".cbAjaxForm,.cbSpinner").remove(),d.element.find(".cbAjaxValue").removeClass("hidden"),d.element.triggerHandler("cbajaxfield.edit.error",[d,e,t,i])},success:function(i,a,l){d.element.find(".cbSpinner").remove();var r=e(i),o=null,s=function(){d.settings.tooltip||d.element.css({width:r.outerWidth(),height:r.outerHeight()})},c=function(){d.element.css({width:"",height:""}),r.removeClass("cbAjaxContainerNoFit");var e=d.element.innerWidth();e||(d.element.css({width:"100%"}),e=d.element.innerWidth()),(!e||d.settings.tooltip)&&r.addClass("cbAjaxContainerNoFit"),r.css(d.settings.tooltip?{minWidth:e}:{width:e}),s();var t=d.element.offset();r.css({top:t.top,left:t.left})};t.call(r),r.appendTo("body"),c(),e(window).on("resize",c),r.find("textarea").on("mouseup",s),r.find("img").on("load",s),null!=n?(o=new n(s),o.observe(r[0],{attributes:!0,childList:!0,characterData:!1,subtree:!0,attributeFilter:["class","style","height","width"]})):r[0].addEventListener("DOMSubtreeModified",s,!1),r.find('.cbTooltip,[data-hascbtooltip="true"]').cbtooltip(),"undefined"!=typeof e.fn.rateit&&r.find("div.rateit:empty,span.rateit:empty").rateit(),r.find(".cbAjaxCancel").on("click",function(t){e(window).off("resize",c),null!=o?o.disconnect():r[0].removeEventListener("DOMSubtreeModified",s,!1),r.remove(),d.element.css({width:"",height:""}),d.element.find(".cbSpinner").remove(),d.element.find(".cbAjaxValue").removeClass("hidden"),"undefined"!=typeof e.fn.mediaelementplayer&&(d.element.find("video.cbVideoFieldEmbed,audio.cbAudioFieldEmbed").mediaelementplayer(!1),d.element.find("video.cbVideoFieldEmbed,audio.cbAudioFieldEmbed").each(function(){e(this).prependTo(e(this).closest(".cbVideoField,.cbAudioField")).nextAll().remove()}),d.element.find("video.cbVideoFieldEmbed:visible,audio.cbAudioFieldEmbed:visible").mediaelementplayer()),d.element.trigger("cbajaxfield.cancel",[d,t])}),r.find(".cbAjaxForm").off("submit"),r.find(".cbAjaxForm").on("submit",function(i){return i.preventDefault(),e(this).ajaxSubmit({type:"POST",dataType:"html",beforeSerialize:function(e,t){d.element.trigger("cbajaxfield.save.serialize",[d,e,t])},beforeSubmit:function(t,i,n){var a=r.find(".cbAjaxForm").data("cbvalidate");return a&&!a.element.cbvalidate("validate")?!1:(e(window).off("resize",c),null!=o?o.disconnect():r[0].removeEventListener("DOMSubtreeModified",s,!1),r.addClass("hidden"),d.element.css({width:"",height:""}),d.element.append('<span class="cbSpinner fa fa-spinner fa-spin-fast"></span>'),void d.element.trigger("cbajaxfield.save.submit",[d,t,i,n]))},error:function(t,i,n){e(window).off("resize",c),null!=o?o.disconnect():r[0].removeEventListener("DOMSubtreeModified",s,!1),r.remove(),d.element.css({width:"",height:""}),d.element.find(".cbSpinner").remove(),d.element.find(".cbAjaxValue").removeClass("hidden"),d.element.trigger("cbajaxfield.save.error",[d,t,i,n])},success:function(i,n,a){e(window).off("resize",c),null!=o?o.disconnect():r[0].removeEventListener("DOMSubtreeModified",s,!1),r.remove(),r=e("<div />").html(i),t.call(r),d.element.css({width:"",height:""}),d.element.find(".cbSpinner").remove(),d.element.find(".cbAjaxValue").html(r.html()).removeClass("hidden"),d.element.find('.cbTooltip,[data-hascbtooltip="true"]').cbtooltip(),"undefined"!=typeof e.fn.rateit&&d.element.find("div.rateit:empty,span.rateit:empty").rateit(),d.element.trigger("cbajaxfield.save.success",[d,i,n,a])}}),!1}),d.element.triggerHandler("cbajaxfield.edit.success",[d,i,a,l])}})}d.element.trigger("cbajaxfield.edit",[d,i])},d.element.on("click",".cbAjaxValue",d.editHandler),d.element.on("remove destroy.cbajaxfield",function(){d.element.cbajaxfield("destroy")}),d.element.on("rebind.cbajaxfield",function(){d.element.cbajaxfield("rebind")}),d.element.on("modified.cbajaxfield",function(e,t,i,n){i!=n&&(d.element.cbajaxfield("destroy"),d.element.cbajaxfield(d.options))}),d.element.on("cloned.cbajaxfield",function(){e(this).off("cloned.cbajaxfield"),e(this).off("modified.cbajaxfield"),e(this).removeData("cbajaxfield"),e(this).find(".cbAjaxValue").removeClass("hidden"),e("body").children(".cbAjaxContainerEdit").remove(),e(this).find(".cbSpinner").remove(),e(this).off("click",".cbAjaxValue",d.editHandler),e(this).cbajaxfield(d.options)}),d.element.trigger("cbajaxfield.init.after",[d]),d.element.data("cbajaxfield",d),i.push(d)))})},rebind:function(){var t=e(this).data("cbajaxfield");return t?(t.element.cbajaxfield("destroy"),t.element.cbajaxfield(t.options),this):this},destroy:function(){var t=e(this).data("cbajaxfield");return t?(t.element.off("destroy.cbajaxfield"),t.element.off("rebind.cbajaxfield"),t.element.off("cloned.cbajaxfield"),t.element.off("modified.cbajaxfield"),e.each(i,function(e,n){return n.element==t.element?(i.splice(e,1),!1):!0}),t.element.find(".cbAjaxValue").removeClass("hidden"),e("body").children(".cbAjaxContainerEdit").remove(),t.element.find(".cbSpinner").remove(),t.element.off("click",".cbAjaxValue",t.editHandler),t.element.removeData("cbajaxfield"),t.element.trigger("cbajaxfield.destroyed",[t]),!0):!1},instances:function(){return i}};e.fn.cbajaxfield=function(e){return n[e]?n[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?this:n.init.apply(this,arguments)},e.fn.cbajaxfield.defaults={init:!0,useData:!0,ignore:"a,video,audio,.mejs-controls,.mejs-overlay",editUrl:null,tooltip:null}}(jQuery);