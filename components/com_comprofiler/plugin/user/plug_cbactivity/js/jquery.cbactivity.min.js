(function(e){var t=[];var a={init:function(a){return this.each(function(){var l=this;var n=e(l).data("cbactivity");if(n){return}n={};n.options=typeof a!="undefined"?a:{};n.defaults=e.fn.cbactivity.defaults;n.settings=e.extend(true,{},n.defaults,n.options);n.element=e(l);if(n.settings.useData){e.each(n.defaults,function(e,t){if(e!="init"&&e!="useData"){var a=n.element.data("cbactivity"+e.charAt(0).toUpperCase()+e.slice(1));if(typeof a!="undefined"){n.settings[e]=a}else{a=n.element.data("cbactivity"+e.charAt(0).toUpperCase()+e.slice(1).toLowerCase());if(typeof a!="undefined"){n.settings[e]=a}}}})}n.element.triggerHandler("cbactivity.init.before",[n]);if(!n.settings.init){return}e.ajaxPrefilter(function(e,t,a){e.async=true});n.actinHandler=function(e){e.preventDefault();m.call(this,n)};e(document).delegate(".streamItemAction","click",n.actinHandler);n.displayEditHandler=function(e){e.preventDefault();g.call(this,n)};e(document).delegate(".streamItemEditDisplay","click",n.displayEditHandler);n.cancelNewHandler=function(e){e.preventDefault();h.call(this,n)};n.element.delegate(".streamItemNewCancel","click",n.cancelNewHandler);n.saveHandler=function(e){e.preventDefault();v.call(this,n)};n.element.delegate(".streamItemForm","submit",n.saveHandler);n.cancelEditHandler=function(e){e.preventDefault();p.call(this,n)};n.element.delegate(".streamItemEditCancel","click",n.cancelEditHandler);n.closeNoticeHandler=function(e){e.preventDefault();y.call(this,n)};n.element.delegate(".streamItemNoticeClose","click",n.closeNoticeHandler);n.revertNoticeHandler=function(e){e.preventDefault();b.call(this,n)};n.element.delegate(".streamItemNoticeRevert","click",n.revertNoticeHandler);n.displayNewHandler=function(e){u.call(this,n)};n.element.delegate(".streamItemNew .streamInputMessage","click",n.displayNewHandler);n.messageLimitHandler=function(e){s.call(this,n)};n.element.delegate(".streamInputMessage","keyup input change",n.messageLimitHandler);n.scrollerLeftHandler=function(e){e.preventDefault();c.call(this,n)};n.element.delegate(".streamItemScrollLeft","click",n.scrollerLeftHandler);n.scrollerRightandler=function(e){e.preventDefault();d.call(this,n)};n.element.delegate(".streamItemScrollRight","click",n.scrollerRightandler);n.locationHandler=function(e){e.preventDefault();o.call(this,n)};n.element.delegate(".streamFindLocation","click",n.locationHandler);n.toggleHandler=function(e){e.preventDefault();f.call(this,n)};n.element.delegate(".streamToggle","click",n.toggleHandler);n.toggleSelectHandler=function(){f.call(this,n)};n.element.delegate("select.streamInputSelect","change",n.toggleSelectHandler);n.moreHandler=function(e){e.preventDefault();I.call(this,n)};n.element.delegate(".streamMore","click",n.moreHandler);r.call(l,n,true);n.element.on("remove destroy.cbactivity",function(){n.element.cbactivity("destroy")});n.element.on("rebind.cbactivity",function(){n.element.cbactivity("rebind")});n.element.on("modified.cbactivity",function(e,t,a,i){if(t!=a){n.element.cbactivity("rebind")}});n.element.on("cloned.cbactivity",function(){i.call(this,n);e(this).cbactivity(n.options)});n.element.triggerHandler("cbactivity.init.after",[n]);n.element.data("cbactivity",n);t.push(n)})},rebind:function(){var t=e(this).data("cbactivity");if(!t){return this}t.element.cbactivity("destroy");t.element.cbactivity(t.options);return this},destroy:function(){var t=e(this).data("cbactivity");if(!t){return this}i.call(t.element,t);t.element.triggerHandler("cbactivity.destroyed",[t]);return this},instances:function(){return t}};function i(t){var a=this.jquery?this:e(this);a.off("destroy.cbactivity");a.off("rebind.cbactivity");a.off("modified.cbactivity");a.off("cloned.cbactivity");a.removeData("cbactivity");e(document).off("click",t.actinHandler);e(document).off("click",t.displayEditHandler);a.off("click",t.locationHandler);a.off("click",t.cancelNewHandler);a.off("submit",t.saveHandler);a.off("click",t.cancelEditHandler);a.off("click",t.closeNoticeHandler);a.off("click",t.revertNoticeHandler);a.off("click",t.scrollerLeftHandler);a.off("click",t.scrollerRightandler);a.off("click",t.toggleHandler);a.off("change",t.toggleSelectHandler);a.off("click",t.moreHandler);a.off("click",t.displayNewHandler);a.off("keyup input change",t.messageLimitHandler);l.call(a.find(".cbMoreLess"),t).cbmoreless("destroy");l.call(a.find(".cbRepeat"),t).cbrepeat("destroy");l.call(a.find(".streamInputAutosize"),t).trigger("autosize.destroy");l.call(a.find("select.streamInputSelect"),t).cbselect("destroy");l.call(a.find(".streamInputMessageLimit"),t).remove();l.call(a.find(".streamItem"),t).each(function(){var t=e(this).data("cbactivity-active-classes");var a=e(this).data("cbactivity-inactive-classes");if(typeof t!="undefined"){e(this).removeClass(t)}if(typeof a!="undefined"){e(this).addClass(a)}})}function l(t){var a=this.jquery?this:e(this);return a.filter(function(){return e(this).closest(".streamContainer").is(t.element)})}function n(t){var a=this.jquery?this:e(this);var i=l.call(a.closest(".streamItem"),t);if(!i.length){var n=a.data("cbactivity-container");if(typeof n!="undefined"){i=l.call(e(n),t)}}return i}function r(t,a){var i=this.jquery?this:e(this);if(a===true){var r=l.call(i.find(".streamInputMessage"),t);r.each(function(){if(!e(this).siblings(".streamInputMessageLimit").length){var t=e(this).data("cbactivity-input-limit");if(typeof t!="undefined"){e(this).trigger("change");e(this).before('<div class="streamInputMessageLimit small hidden"><div class="streamInputMessageLimitCurrent">'+e(this).val().length+'</div> / <div class="streamInputMessageLimitMax">'+t+"</div></div>")}}});l.call(i.find(".cbMoreLess"),t).cbmoreless();l.call(i.find(".cbRepeat"),t).cbrepeat();var s=function(t){var a=e(t.element).data("cbactivity-option-icon");if(typeof a!="undefined"){return e('<span><span class="cb_template streamSelectOptionIcon">'+a+"</span>"+t.text+"</span>")}else{return t.text}};l.call(i.find("select.streamInputSelect"),t).on("cbselect.init.before",function(e,a){if(a.element.val()>0){var i=a.element.data("cbactivity-toggle-target");if(typeof i=="undefined"){return}var r=n.call(a.element,t);if(!r.length){return}var s=a.element.find(":selected");var c=s.data("cbactivity-toggle-placeholder");var d=l.call(r.find(i).find(".streamInputSelectToggleLabel"),t);if(d.length){d.html(s.text())}if(typeof c!="undefined"){var o=l.call(r.find(i).find(".streamInputSelectTogglePlaceholder"),t);if(d.length){o.attr("placeholder",c)}}}}).on("cbselect.init.after",function(e,t){var a=t.element.data("cbactivity-toggle-icon");if(typeof a=="undefined"){return}t.container.find(".select2-selection").addClass(a)}).cbselect({width:"auto",height:"auto",minimumResultsForSearch:Infinity,templateSelection:s,templateResult:s});i.find('.cbTooltip,[data-hascbtooltip="true"]').cbtooltip()}else{l.call(i.find(".streamInputMessageLimit"),t).removeClass("hidden");l.call(i.find(".streamInputAutosize:visible"),t).trigger("autosize.destroy").autosize({append:"",resizeDelay:0,placeholder:false})}t.element.triggerHandler("cbactivity.bind",[t,i,a])}function s(t){var a=this.jquery?this:e(this);var i=n.call(a,t);if(!i.length){return}var r=l.call(i.find(".streamInputMessage"),t);var s=e(this).data("cbactivity-input-limit");if(typeof s!="undefined"){var c=e(this).val().length;if(c>s){e(this).val(e(this).val().substr(0,s))}else{r.siblings(".streamInputMessageLimit").find(".streamInputMessageLimitCurrent").html(e(this).val().length)}}if(e(this).val()){l.call(i.find(".streamItemNewSave,.streamItemEditSave"),t).removeClass("disabled").prop("disabled",false)}else{l.call(i.find(".streamItemNewSave,.streamItemEditSave"),t).addClass("disabled").prop("disabled",true)}}function c(t){var a=this.jquery?this:e(this);var i=n.call(a,t);if(!i.length){return}var l=a.siblings(".streamItemScrollContent:not(.hidden)");var s=l.prevAll(".streamItemScrollContent.hidden:first");if(!s.length){s=a.siblings(".streamItemScrollContent.hidden:last")}if(!s.length){return}s.removeClass("hidden");l.addClass("hidden");r.call(i,t)}function d(t){var a=this.jquery?this:e(this);var i=n.call(a,t);if(!i.length){return}var l=a.siblings(".streamItemScrollContent:not(.hidden)");var s=l.nextAll(".streamItemScrollContent.hidden:first");if(!s.length){s=a.siblings(".streamItemScrollContent.hidden:first")}if(!s.length){return}s.removeClass("hidden");l.addClass("hidden");r.call(i,t)}function o(t){var a=this.jquery?this:e(this);var i=n.call(a,t);if(!i.length){return}var r=a.data("cbactivity-location-target");var s=a.data("cbactivity-location-filter")!=false;if(typeof r=="undefined"){return}if(typeof navigator.geolocation=="undefined"){return}navigator.geolocation.getCurrentPosition(function(e){var a=e.coords.latitude+","+e.coords.longitude;var n=i.find(r);if(s){n=l.call(n,t)}if(n.is("input")){n.val(a)}else{n.html(a)}})}function f(t){var a=this.jquery?this:e(this);var i=n.call(a,t);if(!i.length){return}var r=e.fn.cbselect&&typeof a.data("cbselect")!="undefined";var s=a.data("cbactivity-toggle-target");var c=a.data("cbactivity-toggle-active-classes");var d=a.data("cbactivity-toggle-inactive-classes");var o=a.data("cbactivity-toggle-open")!=false;var f=a.data("cbactivity-toggle-close")!=false;var m=a.data("cbactivity-toggle-filter")!=false;var v=false;if(r||a.is("select")){var u=a.val();if(r){u=a.cbselect("get")}v=!u||u==0||u==""}else{if(a.hasClass("streamToggleOpen")){v=true}}if(v){if(f){a.removeClass("streamToggleOpen");if(r){a.cbselect("container").removeClass("streamToggleOpen")}if(typeof c!="undefined"){a.removeClass(c);if(r){a.cbselect("container").removeClass(c)}}if(typeof d!="undefined"){a.addClass(d);if(r){a.cbselect("container").addClass(d)}}if(typeof s!="undefined"){if(m){l.call(i.find(s),t).addClass("hidden");l.call(i.find(s).find("input,textarea,select"),t).prop("disabled",true)}else{i.find(s).addClass("hidden");i.find(s).find("input,textarea,select").prop("disabled",true)}}}}else{if(o){a.addClass("streamToggleOpen");if(r){a.cbselect("container").addClass("streamToggleOpen")}if(typeof c!="undefined"){a.addClass(c);if(r){a.cbselect("container").addClass(c)}}if(typeof d!="undefined"){a.removeClass(d);if(r){a.cbselect("container").removeClass(d)}}if(typeof s!="undefined"){if(m){l.call(i.find(s),t).removeClass("hidden");l.call(i.find(s).find("input,textarea,select"),t).prop("disabled",false)}else{i.find(s).removeClass("hidden");i.find(s).find("input,textarea,select").prop("disabled",false)}}}}if(a.hasClass("streamInputSelect")&&typeof s!="undefined"){var h=a.find(":selected");var g=h.data("cbactivity-toggle-placeholder");var p=l.call(i.find(s).find(".streamInputSelectToggleLabel"),t);if(p.length){p.html(h.text())}if(typeof g!="undefined"){var y=l.call(i.find(s).find(".streamInputSelectTogglePlaceholder"),t);if(p.length){y.attr("placeholder",g)}}}}function m(t){var a=this.jquery?this:e(this);var i=n.call(a,t);if(!i.length){return}var s=a.data("cbactivity-action-target");var c=a.data("cbactivity-action-output");var d=a.data("cbactivity-confirm");var o=a.data("cbactivity-confirm-button");var f=null;if(typeof s!="undefined"){if(s=="self"){f=a}else{s=l.call(i.find(s),t);if(s.length){f=s}}}var m=function(){e.ajax({url:a.attr("href"),type:"POST",dataType:"html",beforeSend:function(e,l,n){if(f){a.addClass("hidden");a.after('<span class="streamActionLoading fa fa-spinner fa-pulse"></span>')}else{i.addClass("overlay")}t.element.triggerHandler("cbactivity.action.send",[t,a,i,e,l,n])},error:function(e,l,n){if(f){a.removeClass("hidden");a.siblings(".streamActionLoading").remove()}else{i.removeClass("overlay")}t.element.triggerHandler("cbactivity.action.error",[t,a,i,e,l,n])},success:function(l,n,s){var d=null;if(f){d=e(l);a.removeClass("hidden");a.siblings(".streamActionLoading").remove();switch(c){case"before":f.before(d);break;case"after":f.after(d);break;case"prepend":f.prepend(d);break;case"append":f.append(d);break;case"replace":default:f.replaceWith(d);break}a.remove()}else{i.removeClass("overlay");if(l!=""){d=e('<div class="streamItemNotice"><div class="streamItemNoticeMessage">'+l+'</div><a href="javascript:void(0);" class="streamItemNoticeClose"><span class="streamIconClose fa fa-times"></span></a></div>');i.children().addClass("hidden");i.children(".streamItemNotice").remove();i.append(d)}else{if(a.hasClass("streamItemNoticeRevert")){i.children().removeClass("hidden").hide().fadeIn("slow");i.children(".streamItemNotice").remove()}else{i.siblings(".streamItemHeaders").remove();i.remove()}}}if(d){d.hide().fadeIn("slow")}t.element.triggerHandler("cbactivity.action.success",[t,a,i,l,n,s]);if(d){r.call(i,t,true)}}})};if(d){e.cbconfirm(d,{buttonYes:o}).done(m)}else{m()}}function v(t){var a=this.jquery?this:e(this);var i=n.call(a,t);if(!i.length){return false}var l=typeof i.data("cbactivity-id")=="undefined";var s=i.data("cbactivity-error-classes");a.ajaxSubmit({type:"POST",dataType:"html",beforeSend:function(e,n,r){i.addClass("overlay");if(s){i.removeClass(s)}t.element.triggerHandler("cbactivity.save.send",[t,a,i,l,e,n,r])},error:function(e,n,r){i.removeClass("overlay");if(s){i.addClass(s)}t.element.triggerHandler("cbactivity.save.error",[t,a,i,l,e,n,r])},success:function(n,c,d){i.removeClass("overlay");if(s){i.removeClass(s)}var o=e(n);if(l){h.call(a,t);var f=i.siblings(".streamItems");if(t.settings.direction){o.appendTo(f)}else{o.prependTo(f)}}else{i.siblings(".streamItemHeaders").remove();i.replaceWith(o)}o.hide().fadeIn("slow");i=o;t.element.triggerHandler("cbactivity.save.success",[t,a,i,l,n,c,d]);r.call(i,t,true)}});return false}function u(t){var a=this.jquery?this:e(this);var i=n.call(a,t);if(!i.length){return}var s=l.call(i.find(".streamItemDisplay"),t);if(!s.hasClass("hidden")){return}var c=l.call(i.find(".streamInputMessage"),t);var d=c.data("cbactivity-input-size");if(typeof d!="undefined"){c.attr("rows",d)}s.removeClass("hidden");t.element.triggerHandler("cbactivity.new.display",[t,a,i]);r.call(i,t)}function h(t){var a=this.jquery?this:e(this);var i=n.call(a,t);if(!i.length){return}l.call(i.find(".streamInputMessage"),t).attr("rows",1);l.call(i.find(".streamItemDisplay"),t).addClass("hidden");l.call(i.find("input,textarea,select"),t).each(function(){var t=e(this).attr("type");if(t=="checkbox"||t=="radio"){if(t=="radio"&&e(this).siblings('input[type="radio"]').length+1==2&&e(this).val()==0){e(this).prop("checked",true)}else{e(this).prop("checked",false)}}else{if(e(this).is("select")){var a="";if(!e(this).children('option[value=""]:first').length&&!e(this).hasClass("streamInputTags")){a=e(this).children('option[value!=""]:first').val()}if(e.fn.cbselect&&typeof e(this).data("cbselect")!="undefined"){e(this).cbselect("set",a)}else{e(this).val(a)}}else{e(this).val("")}}e(this).trigger("change")});l.call(i.find(".streamToggleOpen"),t).each(function(){f.call(this,t)});l.call(i.find(".cbRepeat"),t).cbrepeat("reset");t.element.triggerHandler("cbactivity.new.cancel",[t,a,i]);r.call(i,t);l.call(i.find(".streamInputMessageLimit"),t).addClass("hidden")}function g(t){var a=this.jquery?this:e(this);var i=n.call(a,t);if(!i.length){return}l.call(i.find(".streamItemEdit"),t).removeClass("hidden");l.call(i.find(".streamItemDisplay"),t).addClass("hidden");t.element.triggerHandler("cbactivity.edit.display",[t,a,i]);r.call(i,t)}function p(t){var a=this.jquery?this:e(this);var i=n.call(a,t);if(!i.length){return}l.call(i.find(".streamItemEdit"),t).addClass("hidden");l.call(i.find(".streamItemDisplay"),t).removeClass("hidden");t.element.triggerHandler("cbactivity.edit.cancel",[t,a,i]);r.call(i,t)}function y(t){var a=this.jquery?this:e(this);if(a.hasClass("streamItemAction")){return}var i=n.call(a,t);if(!i.length){return}i.siblings(".streamItemHeaders").remove();i.remove();t.element.triggerHandler("cbactivity.notice.close",[t,a,i])}function b(t){var a=this.jquery?this:e(this);if(a.hasClass("streamItemAction")){return}var i=n.call(a,t);if(!i.length){return}i.children().removeClass("hidden");i.children(".streamItemNotice").remove();t.element.triggerHandler("cbactivity.notice.revert",[t,a,i])}function I(t){var a=this.jquery?this:e(this);var i=l.call(a.closest(".streamContainer"),t);if(!i.length){return}var n=l.call(i.find(".streamItems"),t);var s=a.attr("href");e.ajax({url:s,type:"POST",dataType:"html",beforeSend:function(e,l,n){a.addClass("disabled").prop("disabled",true).html('<span class="streamIconMoreLoading fa fa-spinner fa-pulse"></span>');t.element.triggerHandler("cbactivity.more.send",[t,a,i,e,l,n])},error:function(e,l,n){a.remove();t.element.triggerHandler("cbactivity.more.error",[t,a,i,e,l,n])},success:function(s,c,d){a.remove();var o=e("<div />").html(s);o.find(".streamItem").each(function(){if(l.call(i.find('.streamItem[data-cbactivity-id="'+e(this).data("cbactivity-id")+'"]'),t).length){e(this).remove()}});var f=e(o.html());if(t.settings.direction){f.prependTo(n);l.call(i.find(".streamMore"),t).insertBefore(n)}else{f.appendTo(n);l.call(i.find(".streamMore"),t).insertAfter(n)}f.hide().fadeIn("slow");t.element.triggerHandler("cbactivity.more.success",[t,a,i,s,c,d]);r.call(f,t,true)}})}e.fn.cbactivity=function(e){if(a[e]){return a[e].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof e==="object"||!e){return a.init.apply(this,arguments)}return this};e.fn.cbactivity.defaults={init:true,useData:true,direction:0}})(jQuery);